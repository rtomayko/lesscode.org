<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head profile="http://gmpg.org/xfn/11">
	<meta http-equiv="Content-Type" 
        content="text/html; charset=UTF-8" />

  <title>  Fun with Fixtures</title>
	<meta name="generator" content="WordPress 2.0.1" />

	<link rel="stylesheet" href="http://lesscode.org/wp-content/themes/almodovar/style.css" type="text/css" media="screen" />
	<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://lesscode.org/feed/" />
	<link rel="alternate" type="text/xml" title="RSS .92" href="http://lesscode.org/feed/rss/" />
	<link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="http://lesscode.org/feed/atom/" />
	<link rel="pingback" href="http://lesscode.org/xmlrpc.php" />

        <script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
        </script>
        <script type="text/javascript">
        _uacct = "UA-125803-1";
        urchinTracker();
        </script>
		<link rel='archives' title='October 2006' href='http://lesscode.org/2006/10/' />
	<link rel='archives' title='April 2006' href='http://lesscode.org/2006/04/' />
	<link rel='archives' title='March 2006' href='http://lesscode.org/2006/03/' />
	<link rel='archives' title='January 2006' href='http://lesscode.org/2006/01/' />
	<link rel='archives' title='December 2005' href='http://lesscode.org/2005/12/' />
	<link rel='archives' title='November 2005' href='http://lesscode.org/2005/11/' />
	<link rel='archives' title='October 2005' href='http://lesscode.org/2005/10/' />
	<link rel='archives' title='September 2005' href='http://lesscode.org/2005/09/' />
	<link rel='archives' title='August 2005' href='http://lesscode.org/2005/08/' />
	<link rel='archives' title='July 2005' href='http://lesscode.org/2005/07/' />
	<link rel='archives' title='June 2005' href='http://lesscode.org/2005/06/' />
	<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://lesscode.org/xmlrpc.php?rsd" />
<script type="text/javascript">
/*-----AJAX-Comment-Preview-Variables-----*/
	var inputId     = 'comment';
	var outputId    = 'ajax-comment-preview';
	var doitId      = 'preview';
	var authorId    = 'author';
	var urlId       = 'url';
	var processURI  = '/wp-content/plugins/ajax-comment-preview.php';
	var emptyString = 'Click the "Preview" button to preview your comment here.';
/*----------------------------------------*/
</script>
<script type="text/javascript" src="/wp-content/plugins/ajax-comment-preview.js"></script>
</head>
<body>

<div id="page">
<h1><a href="http://lesscode.org">lesscode.org</a></h1>
<div id="navcontainer">
		<ul id="navlist">
			<li class="page_item"><a href="http://lesscode.org/archives/" title="archives">archives</a></li>
<li class="page_item"><a href="http://lesscode.org/about/" title="about lesscode.org">about lesscode.org</a></li>
		</ul>
</div>
<hr />

	<div id="content" class="narrowcolumn">

  
		<div class="navigation">
			<div class="alignleft">&laquo; <a href="http://lesscode.org/2005/09/24/web-services-infrastructure-kid/">Web Services Infrastructure: Kid Templating</a></div>
			<div class="alignright"> <a href="http://lesscode.org/2005/09/28/lesscode-is-not-about-quantity/">Lesscode Is Not About Quantity</a> &raquo;</div>
		</div>

		<div class="post">
			<h2 id="post-90"><a href="http://lesscode.org/2005/09/25/fun-with-fixtures/" rel="bookmark" title="Permanent Link: Fun with Fixtures">Fun with Fixtures</a>&nbsp;&nbsp;</h2>
			<small>By <a href="http://naeblis.cx/rtomayko/">Ryan Tomayko</a>
      under <a href="http://lesscode.org/category/languages/ruby/" title="View all posts in Ruby" rel="category tag">Ruby</a>,  <a href="http://lesscode.org/category/by-stack/rails/" title="View all posts in Rails" rel="category tag">Rails</a> 
      on 25. September 2005</small>

			<div class="entrytext">
				<p>My favorite part of <a href="http://www.amazon.com/exec/obidos/tg/detail/-/097669400X/102-5075999-2240140?v=glance" title="Buy this book.">Agile Web Development with Rails</a> is the
section on testing. I&#8217;ve found the framework around testing included
with Rails to be a wonderful blend of simplicity and power and this
chapter in the book is the perfect compliment. It&#8217;s based largely on the
core Ruby <a href="http://www.ruby-doc.org/docs/rdoc/1.9/classes/Test.html" title="RDoc documentation for the Ruby 'Test::Unit' module">Test::Unit</a> module but adds some important features on
top.</p>

<p>One of those features is <a href="http://api.rubyonrails.com/classes/Fixtures.html" title="RDoc documentation for the Rails 'Fixtures' module">Fixtures</a>. Fixtures provide a simple,
<a href="http://www.yaml.org/" title="YAML Ain't Markup Language">YAML</a>-based file format for storing database state that should be
loaded before test runs. The database is wiped and the fixtures are
loaded before each individual test executes, providing consistent state
for tests. See the <a href="http://manuals.rubyonrails.com/read/chapter/26">section on
fixtures</a> in <a href="http://manuals.rubyonrails.com/read/book/5">A Guide to
Testing the Rails</a> for more
information. Here&#8217;s an example fixture from said section:</p>

<pre><code># low &amp; behold!  I am a YAML comment!
david:
 id: 1 
 name: David Heinemeier Hansson 
 birthday: 1979-10-15 
 profession: Systems development

steve:
 id: 2
 name: Steve Ross Kellock
 birthday: 1974-09-27
 profession: guy with keyboard
</code></pre>

<p>The cool thing is that the top level fixture names (in this case,
&#8220;david&#8221; and &#8220;steve&#8221;) become instance variables in your test case,
allowing you to access fixture data in a very intuitively way from
tests. The result of this is test code that reads like a story and is
often almost humorous.</p>

<p><a href="http://www.amazon.com/exec/obidos/tg/detail/-/097669400X/102-5075999-2240140?v=glance" title="Buy this book.">The book</a> includes a sidebar with a little
<a href="http://www.loudthinking.com/">David</a> head lamenting the importance of
&#8220;Picking Good Fixture Names&#8221;:</p>

<p><img src="http://static.flickr.com/33/46283282_2bc2441998_o.png" 
     float="left" style="float: left; padding: 1em 2em; margin-left: 1em" /></p>

<blockquote>
  <p>Just like the names of variables in general, you want to keep the
  names of fixtures as self-explanatory as possible. This increases the
  readability of the tests when you&#8217;re asserting that
  <code>@valid_order_for_fred</code> is indeed Fred&#8217;s valid order. It also makes it a
  lot easier to remember which fixture you&#8217;re supposed to test against
  without having to look up <code>p1</code> or <code>order4</code>. The more fixtures you get, the
  more important it is to pick good fixture names. So, starting early
  keeps you happy later.</p>
  
  <p>But what to do with fixtures that can&#8217;t easily get a self-explanatory
  name like <code>@valid_order_for_fred?</code> Pick natural names that you have an
  easier time associating to a role. For example, instead of using
  <code>order1</code>, use <code>christmas_order</code>. Instead of <code>customer1</code>, use <code>fred</code>. Once
  you get into the habit of natural names, youâ€™ll soon be weaving a nice
  little story about how <code>fred</code> is paying for his <code>christmas_order</code> with
  his <code>invalid_credit_card</code> first, then paying his <code>valid_credit_card</code>, and
  finally choosing to ship it all off to <code>aunt_mary</code>.  </p>
  
  <p><strong>Association-based stories are key to remembering large worlds of
  fixtures with ease.</strong></p>
</blockquote>

<p>Taking this advice, I started in on testing a part of an application I&#8217;m
working on now. The result is worth posting in it&#8217;s entirety (hint: it gets
interesting towards the middle):</p>

<pre style="font-size: 110%; line-spacing: 120%; border: 0; margin-left: 0; padding-left: 0">
<B><FONT COLOR="#5F9EA0">require</FONT></B> File.dirname(__FILE__) + <B><FONT COLOR="#BC8F8F">&#8216;/../test_helper&#8217;</FONT></B>

<B><FONT COLOR="#A020F0">class</FONT></B> EnrolleeTest &lt; Test::Unit::TestCase
  fixtures :coverage_types, :plans, :coverages, :plan_levels, :ppo_options,
           :elections, :enrollees, :enrollments, :tpas, :tpas_users, :users,
           :roles

  <B><FONT COLOR="#A020F0">def</FONT></B> <B><FONT COLOR="#0000FF">setup
</FONT></B>    <FONT COLOR="#B8860B">@joe</FONT> = Enrollee.find(<FONT COLOR="#B8860B">@joe_the_policy_holder</FONT>.id)
    <FONT COLOR="#B8860B">@rita</FONT> = Enrollee.find(<FONT COLOR="#B8860B">@rita_the_spouse</FONT>.id)
    <FONT COLOR="#B8860B">@billy</FONT> = Enrollee.find(<FONT COLOR="#B8860B">@billy_the_dependent</FONT>.id)
    <FONT COLOR="#B8860B">@alice</FONT> = Enrollee.find(<FONT COLOR="#B8860B">@alice_the_dependent</FONT>.id)
    <FONT COLOR="#B8860B">@the_family</FONT> = [<FONT COLOR="#B8860B">@joe</FONT>, <FONT COLOR="#B8860B">@rita</FONT>, <FONT COLOR="#B8860B">@billy</FONT>, <FONT COLOR="#B8860B">@alice</FONT>]
    <FONT COLOR="#B8860B">@enrollment</FONT> = Enrollment.find(<FONT COLOR="#B8860B">@test_enrollment</FONT>.id)
  <B><FONT COLOR="#A020F0">end</FONT></B>

  <I><FONT COLOR="#B22222">
</FONT></I>  <B><FONT COLOR="#A020F0">def</FONT></B> <B><FONT COLOR="#0000FF">test_common_attrs
</FONT></B>    <FONT COLOR="#B8860B">@the_family</FONT>.each <B><FONT COLOR="#A020F0">do</FONT></B> |enrollee|
      assert_kind_of Enrollee, enrollee
      assert_equal <FONT COLOR="#B8860B">@enrollment</FONT>.id, enrollee.enrollment_id
      assert_equal <FONT COLOR="#B8860B">@enrollment</FONT>, enrollee.enrollment
      assert_equal <FONT COLOR="#B8860B">@joe</FONT>.id, enrollee.policy_holder_id
      assert_equal <FONT COLOR="#B8860B">@joe</FONT>, enrollee.policy_holder
    <B><FONT COLOR="#A020F0">end</FONT></B>
  <B><FONT COLOR="#A020F0">end</FONT></B>

  <B><FONT COLOR="#A020F0">def</FONT></B> <B><FONT COLOR="#0000FF">test_get_gender
</FONT></B>    assert_equal :male, <FONT COLOR="#B8860B">@joe</FONT>.gender, <B><FONT COLOR="#BC8F8F">&quot;Joe is a male&quot;</FONT></B>
    assert <FONT COLOR="#B8860B">@joe</FONT>.male?, <B><FONT COLOR="#BC8F8F">&quot;Joe is a male&quot;</FONT></B>
    assert_equal :female, <FONT COLOR="#B8860B">@rita</FONT>.gender, <B><FONT COLOR="#BC8F8F">&quot;Rita is a female&quot;</FONT></B>
    assert <FONT COLOR="#B8860B">@rita</FONT>.female?, <B><FONT COLOR="#BC8F8F">&quot;Rita is a female&quot;</FONT></B>
    assert !<FONT COLOR="#B8860B">@billy</FONT>.female?, <B><FONT COLOR="#BC8F8F">&quot;Billy is not a female&quot;</FONT></B>
    assert !<FONT COLOR="#B8860B">@alice</FONT>.male?, <B><FONT COLOR="#BC8F8F">&quot;Sally is not a male&quot;</FONT></B>
  <B><FONT COLOR="#A020F0">end</FONT></B>

  <B><FONT COLOR="#A020F0">def</FONT></B> <B><FONT COLOR="#0000FF">test_set_gender
</FONT></B>    [:female, <B><FONT COLOR="#BC8F8F">&#8216;F&#8217;</FONT></B>, 2].each <B><FONT COLOR="#A020F0">do</FONT></B> |tok|
      <FONT COLOR="#B8860B">@joe</FONT>.gender = tok
      assert_equal :female, <FONT COLOR="#B8860B">@joe</FONT>.gender, <B><FONT COLOR="#BC8F8F">&quot;Joe is now a female&quot;</FONT></B>
      assert <FONT COLOR="#B8860B">@joe</FONT>.save, <B><FONT COLOR="#BC8F8F">&quot;Joe could not be saved after sex change&quot;</FONT></B>
      <FONT COLOR="#B8860B">@joe</FONT>.reload
      assert_equal :female, <FONT COLOR="#B8860B">@joe</FONT>.gender, <B><FONT COLOR="#BC8F8F">&quot;Joe is now a female&quot;</FONT></B>
    <B><FONT COLOR="#A020F0">end</FONT></B>

    [:male, <B><FONT COLOR="#BC8F8F">&#8216;M&#8217;</FONT></B>, 1].each <B><FONT COLOR="#A020F0">do</FONT></B> |tok|
      <FONT COLOR="#B8860B">@rita</FONT>.gender = tok
      assert_equal :male, <FONT COLOR="#B8860B">@rita</FONT>.gender, <B><FONT COLOR="#BC8F8F">&quot;Rita is now a male&quot;</FONT></B>
      assert <FONT COLOR="#B8860B">@rita</FONT>.save, <B><FONT COLOR="#BC8F8F">&quot;Rita could not be saved after sex change&quot;</FONT></B>
      <FONT COLOR="#B8860B">@rita</FONT>.reload
      assert_equal :male, <FONT COLOR="#B8860B">@rita</FONT>.gender, <B><FONT COLOR="#BC8F8F">&quot;Rita is now a male&quot;</FONT></B>
    <B><FONT COLOR="#A020F0">end</FONT></B>

    <I><FONT COLOR="#B22222"># make sure that we can set it to nil
</FONT></I>    <FONT COLOR="#B8860B">@joe</FONT>.gender = <B><FONT COLOR="#A020F0">nil</FONT></B>
    assert_equal <B><FONT COLOR="#A020F0">nil</FONT></B>, <FONT COLOR="#B8860B">@joe</FONT>.gender
    assert <FONT COLOR="#B8860B">@joe</FONT>.save(<B><FONT COLOR="#A020F0">false</FONT></B>), <B><FONT COLOR="#BC8F8F">&quot;Joe couldn&#8217;t be saved after neutering&#8230;&quot;</FONT></B>
    <FONT COLOR="#B8860B">@joe</FONT>.reload
    assert_equal <B><FONT COLOR="#A020F0">nil</FONT></B>, <FONT COLOR="#B8860B">@joe</FONT>.gender

    <FONT COLOR="#B8860B">@joe</FONT>.gender = <B><FONT COLOR="#BC8F8F">&#8216;&#8217;</FONT></B>
    assert_equal <B><FONT COLOR="#A020F0">nil</FONT></B>, <FONT COLOR="#B8860B">@joe</FONT>.gender
    assert <FONT COLOR="#B8860B">@joe</FONT>.save(<B><FONT COLOR="#A020F0">false</FONT></B>), <B><FONT COLOR="#BC8F8F">&quot;Joe couldn&#8217;t be saved after neutering&#8230;&quot;</FONT></B>
    <FONT COLOR="#B8860B">@joe</FONT>.reload
    assert_equal <B><FONT COLOR="#A020F0">nil</FONT></B>, <FONT COLOR="#B8860B">@joe</FONT>.gender
  <B><FONT COLOR="#A020F0">end</FONT></B>

  <B><FONT COLOR="#A020F0">def</FONT></B> <B><FONT COLOR="#0000FF">test_marital_status
</FONT></B>    assert_equal :married, <FONT COLOR="#B8860B">@joe</FONT>.marital_status
    assert <FONT COLOR="#B8860B">@joe</FONT>.married?, <B><FONT COLOR="#BC8F8F">&quot;Joe is married&quot;</FONT></B>
    assert !<FONT COLOR="#B8860B">@joe</FONT>.single?, <B><FONT COLOR="#BC8F8F">&quot;Joe is not single&quot;</FONT></B>
    assert <FONT COLOR="#B8860B">@billy</FONT>.single?, <B><FONT COLOR="#BC8F8F">&quot;Billy is single&quot;</FONT></B>
    assert !<FONT COLOR="#B8860B">@billy</FONT>.married?, <B><FONT COLOR="#BC8F8F">&quot;Billy is not married&quot;</FONT></B>
    assert_equal :single, <FONT COLOR="#B8860B">@billy</FONT>.marital_status
  <B><FONT COLOR="#A020F0">end</FONT></B>

  <B><FONT COLOR="#A020F0">def</FONT></B> <B><FONT COLOR="#0000FF">test_set_marital_status
</FONT></B>    [:married, 2].each <B><FONT COLOR="#A020F0">do</FONT></B> |tok|
      <FONT COLOR="#B8860B">@billy</FONT>.marital_status = tok
      assert_equal :married, <FONT COLOR="#B8860B">@billy</FONT>.marital_status
      assert <FONT COLOR="#B8860B">@billy</FONT>.save, <B><FONT COLOR="#BC8F8F">&quot;Billy could not be saved after he got married&quot;</FONT></B>
      <FONT COLOR="#B8860B">@billy</FONT>.reload
      assert_equal :married, <FONT COLOR="#B8860B">@billy</FONT>.marital_status
    <B><FONT COLOR="#A020F0">end</FONT></B>

    [:single, 1].each <B><FONT COLOR="#A020F0">do</FONT></B> |tok|
      <FONT COLOR="#B8860B">@rita</FONT>.marital_status = tok
      assert_equal :single, <FONT COLOR="#B8860B">@rita</FONT>.marital_status
      assert <FONT COLOR="#B8860B">@rita</FONT>.save, <B><FONT COLOR="#BC8F8F">&quot;Rita could not be saved after her divorce&quot;</FONT></B>
      <FONT COLOR="#B8860B">@rita</FONT>.reload
      assert_equal :single, <FONT COLOR="#B8860B">@rita</FONT>.marital_status
    <B><FONT COLOR="#A020F0">end</FONT></B>
  <B><FONT COLOR="#A020F0">end</FONT></B>
<B><FONT COLOR="#A020F0">end</FONT></B>
</pre>

<p>:)</p>

				
        <a name="comments"> </a>
				<p class="postmetadata alter">
					<a href='http://lesscode.org/2005/09/25/fun-with-fixtures/feed/'>Comment <acronym title="Really Simple Syndication">RSS</acronym></a> -

													<a href="http://lesscode.org/2005/09/25/fun-with-fixtures/trackback/">Trackback <acronym title="Uniform Resource Identifier">URI</acronym></a>

						
				</p>

			</div>
		</div>

	
<!-- You can start editing here. -->

	<h3 id="comments">2 Responses to &#8220;Fun with Fixtures&#8221;</h3>

	<ol class="commentlist">
  	
		<li class="alt" id="comment-440">
			<p class="who"><cite><a href='http://rimantas.com/' rel='external ' title='85.206.198.242'>Rimantas</a></cite>:</p>
			<p>Is this the interesting part:</p>
<p>assert !@alice.male?, &#8220;Sally is not a male&#8221;</p>
<p>;)</p>
      <p>
			<small>comment at <a href="#comment-440" title="">25. September 2005</a> </small>
						</p>

		</li>

	
	
		<li class="alt" id="comment-441">
			<p class="who"><cite><a href='http://naeblis.cx/rtomayko/' rel='external ' title='69.168.180.186'>Ryan Tomayko</a></cite>:</p>
			<p>Nice catch!</p>
      <p>
			<small>comment at <a href="#comment-441" title="">25. September 2005</a> </small>
						</p>

		</li>

	
	        
	</ol>

 


<h3 id="respond">Leave a Reply</h3>


<form action="http://lesscode.org/wp-comments-post.php" method="post" id="commentform">


<p>
  <small>
    <strong>Note:</strong> None of this information is required but 
    leaving a Name and URL is much appreciated. You can also <a href="/wp-register.php">register</a>
    to have this stuff remembered.
  </small>
</p>

<p><input type="text" name="author" id="author" value="" size="22" tabindex="1" />
<label for="author"><small>Name </small></label></p>

<p><input type="text" name="email" id="email" value="" size="22" tabindex="2" />
<label for="email"><small>Mail (will not be published) </small></label></p>

<p><input type="text" name="url" id="url" value="" size="22" tabindex="3" />
<label for="url"><small>Website</small></label></p>


<div id="ajax-comment-preview" style="padding: .4em 0; color: #666; margin-top: 1em; border-top: 1px solid #ddd; border-bottom: 1px solid #ddd">Your comment can be previewed here.</div>

<p>
  <br />
  <small>
    <strong><a href="http://daringfireball.net/projects/markdown/syntax"
       title="Markdown Syntax Reference">Markdown</a>:</strong> 
    use the force, Luke.
  </small>
</p>

<p>
  <textarea name="comment" id="comment" cols="100%" rows="10" tabindex="4"></textarea>
</p>

<p>
  <input name="submit" type="submit" id="submit" tabindex="5" value="Submit Comment" />
<input type="hidden" name="comment_post_ID" value="90" />
</p>
<input name="preview" type="button" id="preview" tabindex="6" value="Preview" /><div id="ajax-comment-preview"></div>
</form>



	
	</div>


<div id="footer">
	<p style="float: left;">
		feeds: 
    <a href="http://lesscode.org/feed/atom/" title="Atom 0.3 feed for all posts">
      posts</a> (<a href="http://feedvalidator.org/check.cgi?url=http://lesscode.org/feed/atom/">valid?</a>)
    or <a href="http://lesscode.org/comments/feed/" title="RSS 2.0 feed for comments">comments</a>
       (<a href="http://feedvalidator.org/check.cgi?url=http://lesscode.org/comments/feed/">valid?</a>)
    <br />
		design by <a href="http://blog.ratterobert.com/">ratter / robert</a><br />
		powered by <a href="http://wordpress.org">WordPress</a>.<a href="http://wordpress.de">de</a><br />
	</p>
		<a name="search"><form method="get" id="searchform" action="/index.php">
<div><input type="text" value="" name="s" id="s" />
<input type="submit" id="searchsubmit" value="Search" />
</div>
</form>
</a>
</div>
<div id="switcher">
	<center>
			</center>
</div>
</div>
		</body>
</html>

<!-- Dynamic Page Served (once) in 0.350 seconds -->
<!-- Cached page served by WP-Cache -->
